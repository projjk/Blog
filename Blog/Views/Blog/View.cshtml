@{
    ViewData["Title"] = "";
}
@using BlogView = Blog.ViewModels.BlogView
@using Blog.ViewModels
@using Microsoft.AspNetCore.Identity
@using Blog.Areas.Identity.Data
@inject SignInManager<BlogUser> SignInManager
@inject UserManager<BlogUser> UserManager
@model BlogView

<div class="container">
    @if (Model != null)
    {
        <h1><a asp-route="blog" asp-route-blogAddress="@Model.BlogAddress" class="text-decoration-none text-dark"><i class="fs-3 fas fa-arrow-left"></i> @Model.BlogTitle</a></h1>

        <div id="article">
            <div class="row mt-5">
                <div class="col bg-light fw-bolder fs-3">@Model.Title</div>
            </div>
            <div class="row mt-2 mb-4">
                <div class="col text-secondary">By <span class="text-dark">@Model.Owner.DisplayName</span> - @Model.PostDate</div>
                @if (Model.IsOwner)
                {
                    <div class="col text-end">
                        <a asp-controller="Blog" asp-action="Write" asp-route-articleId="@Model.Id" class="text-secondary"><i class="far fa-edit"></i></a>
                        <a data-bs-toggle="modal" data-bs-target="#exampleModal" style="cursor: pointer;"><i class="far fa-trash-alt"></i></a>
                        <!-- Modal -->
                        <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
                            <div class="modal-dialog">
                                <div class="modal-content">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="exampleModalLabel">Delete</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        Do you really want to delete this article?
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">No</button>
                                        @await Html.PartialAsync("_DeleteArticle", new BlogDeleteArticle { BlogAddress = Model.BlogAddress, ArticleId = Model.Id })

                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
            <div class="row mb-5">
                <div class="col">@Model.Body</div>
            </div>
            @if (Model.Tags!.Count != 0)
            {
                int count = 0;
                <div class="row mb-3">
                    <div class="col">
                        @foreach (var tag in Model.Tags)
                        {
                            count++;
                            <a asp-route="blogIndexTag" asp-route-blogAddress="@Model.BlogAddress" asp-route-tag="@tag.Name" class="text-secondary">@tag.Name</a>
                            @if (count != Model.Tags.Count)
                            {
                                @:,
                            }
                        }
                    </div>
                </div>
            }
            <div id="comments"></div>
            @foreach (var comment in Model.Comments!)
            {
                <div class="row comments mb-3">
                    <div class="comment-header">
                        <span class="fw-bold">@comment.Author</span><span class="ms-2 datetime text-secondary">@comment.PostDate</span>
                    </div>
                    <p class="comment-content mt-1">@comment.Body</p>
                </div>
            }
            @await Html.PartialAsync("_WriteCommentPartial", new BlogWriteComment { BlogAddress = Model.BlogAddress, ArticleId = Model.Id, ArticleUrl = Model.Url })
        </div>
    }
</div>

@section Scripts
{
    <partial name="_ValidationScriptsPartial"/>
}